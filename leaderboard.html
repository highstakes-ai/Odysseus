<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Fitted Launch Referral Contest</title>
  <meta name="description" content="Join the Fitted referral contest – refer friends to climb the leaderboard and win massive prizes!" />
  <link rel="stylesheet" href="styles.css">
</head>
<body>
  <!-- Load header module -->
  <script src="header.js"></script>
  <!-- Landing Hero Container (full-width) -->
  <div class="landing-hero">
    <img src="Fitted_Hero.png" alt="Fitted Hero" class="landing-hero-image">
   
    <div class="landing-overlay">
      <h1 class="landing-title">
        See an <span class="angon-text">outfit</span><br>you love?
      </h1>
      <p class="landing-subtitle">Fitted captures the vibe and finds shoppable matches you can buy instantly.</p>
      <button class="landing-signup-btn scroll-to-auth">
        Join Waitlist
      </button>
    </div>
  </div>
    <!-- New section below the hero -->
    <div class="hero-info-section">
      <p class="hero-info-text">
        The next-generation AI that curates shoppable clothing from millions of items across hundreds of stores.
        Upload any outfit image, get perfect vibes-matched pieces, and purchase in one click.
      </p>
      <div class="hero-stats-box" id="stats-box">
        <div class="count-up" data-target="1000000" data-start="700000">1,000,000+ Products</div>
        <div class="count-up" data-target="300" data-start="150">300+ Sites</div>
        <div>1 Click Purchase</div>
      </div>
      <!-- Begin with a style reference section -->
      <div class="style-reference-section">
        <div class="style-reference-card">
          <h2 class="style-ref-title">Begin with<br><span class="angon-text">style</span> reference</h2>
        
          <div class="style-ref-content">
            <div class="style-ref-text-block">
              <p class="style-ref-description">
                Upload 1—5 pics<br>
                AI fuses the vibes into a fresh,<br>
                cohesive style
              </p>
            </div>
          
            <div class="style-ref-images">
              <img
                src="Images/style_reference_1.png"
                alt="Main style reference outfit"
                class="style-ref-image style-ref-image-large"
              >
              <img
                src="Images/style_reference_2.png"
                alt="Secondary style reference outfit"
                class="style-ref-image style-ref-image-small"
              >
            </div>
          </div>
        
          <!-- New Join Waitlist button -->
          <button class="hero-participate-btn scroll-to-auth">
            Join Waitlist
          </button>
        </div>
      </div>
      <!-- Perfect matches section -->
      <div class="perfect-matches-section">
        <div class="perfect-matches-card">
          <h2 class="perfect-matches-title">Get <span class="angon-text">perfect</span><br>matches</h2>
        
          <div class="perfect-matches-content">
            <div class="perfect-matches-text-block">
              <p class="perfect-matches-description">
                Only see what you’d actually wear<br>And stick within your budget.
              </p>
            </div>
          
            <div class="perfect-matches-image-container">
              <img
                src="Images/perfect_match_result.png"
                alt="Curated perfect match outfit"
                class="perfect-matches-image"
              >
            </div>
          </div>
        
          <!-- Join Waitlist button -->
          <button class="hero-participate-btn scroll-to-auth">
            Join Waitlist
          </button>
        </div>
      </div>
      <!-- Virtual Try-On section -->
      <div class="virtual-tryon-section">
        <div class="virtual-tryon-card">
          <h2 class="virtual-tryon-title">Virtual <span class="angon-text">Try-On</span></h2>
          <p class="virtual-tryon-subtitle">
            Try on your entire cart<br>See the full outfit<br>
            on your actual body in seconds.
          </p>
          <div class="tryon-preview-grid">
            <!-- Main central image (person wearing outfit) -->
            <div class="tryon-main-preview">
              <img
                src="Images/virtual_try_on_full_body.png"
                alt="Virtual try-on result - full outfit on body"
                class="tryon-main-image"
              >
            </div>
            <!-- Small floating product thumbnails -->
            <img
              src="Images/virtual_try_on_jacket.png"
              alt="Light denim jacket"
              class="tryon-thumbnail top-left"
            >
            <img
              src="Images/virtual_try_on_shirt.png"
              alt="Graphic t-shirt"
              class="tryon-thumbnail top-right"
            >
            <img
              src="Images/virtual_try_on_bottoms.png"
              alt="Mini skirt"
              class="tryon-thumbnail bottom-left"
            >
            <img
              src="Images/virtual_try_on_shoes.png"
              alt="Red boots"
              class="tryon-thumbnail bottom-right"
            >
          </div>
          <!-- New Join Waitlist button -->
            <button class="hero-participate-btn scroll-to-auth">
              Join Waitlist
            </button>
          </div>
        </div>
      <!-- One-Click Multi-Store Cart section -->
      <div class="multi-store-cart-section">
        <div class="multi-store-card">
          <h2 class="multi-store-title"><span class="angon-text">One-Click</span><br>Multi-Store Cart</h2>
        
          <p class="multi-store-subtitle">
            Add every piece from every store<br>in one click. We handle the rest.
          </p>
        
          <!-- Orbiting logos layout -->
          <div class="multi-store-orbit-container">
            <!-- Store Logo 1 (top-left) -->
            <img src="Images/gym_shark_logo.png" alt="Gym Shark" class="store-logo logo-top-left">
          
            <!-- Store Logo 2 (bottom-left) -->
            <img src="Images/allbirds_logo.png" alt="Allbirds" class="store-logo logo-bottom-left">
          
            <!-- Store Logo 3 (bottom-right) -->
            <img src="Images/skims_logo.png" alt="Skims" class="store-logo logo-bottom-right">
          
            <!-- Central Cart Icon — use a dedicated class -->
            <img src="Images/multi_store_cart.svg" alt="One-Click Cart" class="central-cart-icon">
          </div>
        
          <!-- Button now INSIDE the card -->
          <button class="hero-participate-btn scroll-to-auth">
            Join Waitlist
          </button>
        </div>
      </div>
      <!-- Hero Image Section with Text Overlay -->
      <div class="hero-section">
        <img src="Gems_Scatter_Final.png" alt="Fitted Gems Hero" class="hero-image">
        <!-- Big 100,000 number - outside the glass box -->
        <div class="hero-grand-prize">
          <h1 class="grand-prize-number"><span class="angon-text">100k Gems</span><br>Contest</h1>
        </div>
        <!-- Glass box with "Participate Now" – now a button -->
        <div class="hero-text-overlay">
          <button class="hero-participate-btn scroll-to-auth">
            Participate Now
          </button>
        </div>
      </div>
        
      <div class="prize-list">
        <p class="subtitle">Prize Breakdown</p>
        <div class="prize-item">
          <span class="rank-label">1st</span>
          <span class="amount">30,000</span>
        </div>
        <div class="prize-item">
          <span class="rank-label">2nd</span>
          <span class="amount">20,000</span>
        </div>
        <div class="prize-item">
          <span class="rank-label">3rd</span>
          <span class="amount">15,000</span>
        </div>
        <div class="prize-item">
          <span class="rank-label">4-6th</span>
          <span class="amount">8,000</span>
        </div>
        <div class="prize-item">
          <span class="rank-label">7-10th</span>
          <span class="amount">5,000</span>
        </div>
      </div>
      <div class="leaderboard-header">
        <div class="lb-title">Contest Leaderboard</div>
        <div class="live-badge">
          Live
        </div>
      </div>
      <div class="leaderboard-section">
        <div class="leaderboard-table" style="border-radius:0 12px 12px 0;">
          <div class="lb-header">
            <div class="lb-rank">Rank</div>
            <div class="lb-user">User</div>
            <div class="lb-refs">Referrals</div>
          </div>
          <div id="leaderboard-body">
            <div class="loading">Loading live leaderboard...</div>
          </div>
        </div>
      </div>
      <!-- Unified Join / Check Section -->
      <div class="unified-auth-section">
        <div class="auth-title" id="auth-heading">Join or Check Progress</div>
        <p class="auth-subtitle" id="auth-subtitle">Enter your email to join the waitlist or view your referral stats</p>
        <form id="auth-form" class="auth-form">
          <input
            type="email"
            id="auth-email"
            name="email"
            class="email-input"
            placeholder="Your email"
            required
          />
          <input
            type="text"
            id="auth-ref-code"
            class="email-input"
            placeholder="Referral code (optional)"
            maxlength="10"
            style="margin-top: 0.8rem;"
          />
          <button type="submit" class="submit-btn" id="auth-btn">Continue</button>
          <div id="auth-message"></div>
        </form>
        <!-- Gems total & milestones will appear here after successful check/login -->
        <div class="gems-total" id="gems-total" style="display:none; margin-top:1.5rem;"></div>
        <div class="milestones" id="milestones" style="display:none;"></div>
        <div class="claim-feedback" id="claim-feedback"></div>
      </div>
    </div>
  </div>
  <!-- Load modular tasks system -->
  <script src="tasks.js"></script>
  <!-- Fixed: All scripts consolidated + scroll handler wrapped in DOMContentLoaded -->
  <script>
    // Leaderboard load with dummy fallback
    async function loadLeaderboard() {
      const container = document.getElementById('leaderboard-body');
      container.innerHTML = '<div class="loading">Loading leaderboard...</div>';
      const dummyData = [
        { email: "zz@gmail.com", referrals: 6 },
        { email: "xx@gmail.com", referrals: 1 },
        { email: "aaa@gmail.com", referrals: 0 },
        { email: "sss@gmail.com", referrals: 0 },
        { email: "ssas@gmail.com", referrals: 0 }
      ];
      try {
        const res = await fetch(`${WORKER_URL}/leaderboard`);
        if (!res.ok) throw new Error("Leaderboard fetch failed");
        const data = await res.json();
        if (data.length === 0) {
          container.innerHTML = '<div class="loading">No referrals yet – be the first!</div>';
          return;
        }
        renderLeaderboard(data);
      } catch (err) {
        console.warn("Using dummy data because:", err.message);
        renderLeaderboard(dummyData);
      }
      function renderLeaderboard(users) {
        const sorted = [...users].sort((a, b) => b.referrals - a.referrals);
        container.innerHTML = sorted.map((user, index) => {
          const rank = index + 1;
          const displayName = user.email.includes('@')
            ? user.email.split('@')[0] + '***'
            : user.email;
          const rankLabel = getRankLabel(rank);
          return `
            <div class="lb-row">
              <div class="lb-rank-num">${rankLabel}</div>
              <div class="lb-user-name">${displayName}</div>
              <div class="lb-refs-num">${user.referrals}</div>
            </div>
          `;
        }).join('');
      }
      function getRankLabel(rank) {
        if (rank === 1) return "1st";
        if (rank === 2) return "2nd";
        if (rank === 3) return "3rd";
        return `${rank}th`;
      }
    }
    loadLeaderboard();

    // Pre-fill referral code
    const urlParams = new URLSearchParams(window.location.search);
    const urlRef = urlParams.get('ref');
    if (urlRef && document.getElementById('auth-ref-code')) {
      document.getElementById('auth-ref-code').value = urlRef.toUpperCase();
    }

    // Unified auth form logic (join or check)
    const authForm = document.getElementById('auth-form');
    const authEmailInput = document.getElementById('auth-email');
    const authRefInput = document.getElementById('auth-ref-code');
    const authBtn = document.getElementById('auth-btn');
    const authMessage = document.getElementById('auth-message');
    const gemsTotal = document.getElementById('gems-total');
    const milestonesDiv = document.getElementById('milestones');
    const authHeading = document.getElementById('auth-heading');
    const authSubtitle = document.getElementById('auth-subtitle');

    authForm.addEventListener('submit', async (e) => {
      e.preventDefault();
      authMessage.innerHTML = '';
      authBtn.disabled = true;
      authBtn.textContent = 'Processing...';
      const email = authEmailInput.value.trim().toLowerCase();
      const manualRefCode = authRefInput.value.trim().toUpperCase();
      let ref = urlParams.get('ref') || '';
      if (manualRefCode) ref = manualRefCode;
      if (!email || !email.includes('@')) {
        authMessage.innerHTML = '<div class="message error">Please enter a valid email</div>';
        authBtn.disabled = false;
        authBtn.textContent = 'Continue';
        return;
      }
      try {
        const statusRes = await fetch(`${WORKER_URL}/status?email=${encodeURIComponent(email)}`);
        if (statusRes.ok) {
          const user = await statusRes.json();
          TasksModule.setUser({
            email: user.email,
            referrals: user.referrals,
            gemsEarned: user.gemsEarned || 0,
            confirmed: user.confirmed,
            claimedMilestones: user.claimedMilestones || []
          });
          gemsTotal.style.display = 'block';
          gemsTotal.textContent = `Gems Earned: ${user.gemsEarned || 0}`;
          milestonesDiv.style.display = 'block';
          TasksModule.render();
          authHeading.textContent = 'Your Progress';
          authSubtitle.style.display = 'none';
          authForm.style.display = 'none';
          authMessage.innerHTML = '<div class="message success">Stats loaded!</div>';
          loadLeaderboard();
        } else {
          const formData = new FormData();
          formData.append('email', email);
          const endpoint = ref ? `${WORKER_URL}/signup?ref=${encodeURIComponent(ref)}` : `${WORKER_URL}/signup`;
          const signupRes = await fetch(endpoint, { method: 'POST', body: formData });
          const result = await signupRes.json();
          if (signupRes.ok && result.success) {
            let successMsg = result.message || 'Welcome! You’re now on the waitlist.';
            if (result.code) {
              successMsg += `<br><br>Your referral code: <strong>${result.code}</strong><br>Share: <strong>https://highstakes-ai.github.io/Odysseus/leaderboard.html?ref=${result.code}</strong>`;
            }
            authMessage.innerHTML = `<div class="message success">${successMsg}</div>`;
            authHeading.textContent = 'Your Progress';
            authSubtitle.style.display = 'none';
            authForm.style.display = 'none';
            gemsTotal.style.display = 'block';
            gemsTotal.textContent = 'Gems Earned: 0';
            milestonesDiv.style.display = 'block';
            TasksModule.render();
            authForm.reset();
            authRefInput.value = '';
            loadLeaderboard();
          } else {
            authMessage.innerHTML = `<div class="message error">${result.error || 'Something went wrong'}</div>`;
          }
        }
      } catch (err) {
        authMessage.innerHTML = '<div class="message error">Network error – try again</div>';
      }
      authBtn.disabled = false;
      authBtn.textContent = 'Continue';
    });

    // Count-up animation
    function startCountUpWhenVisible() {
      const statsBox = document.getElementById('stats-box');
      if (!statsBox) return;
      const counters = statsBox.querySelectorAll('.count-up');
      const observer = new IntersectionObserver((entries) => {
        entries.forEach(entry => {
          if (entry.isIntersecting) {
            counters.forEach(counter => {
              const target = parseInt(counter.getAttribute('data-target'));
              const start = parseInt(counter.getAttribute('data-start')) || 0;
              const duration = 5000;
              const increment = target / (duration / 16);
              let current = start;
              const timer = setInterval(() => {
                current += increment;
                if (current >= target) {
                  current = target;
                  clearInterval(timer);
                }
                const formatted = Math.floor(current).toLocaleString();
                const text = counter.textContent;
                const suffix = text.includes('+') ? '+' : '';
                const label = text.replace(/[\d,]+\/?\+?/, '').trim();
                counter.innerHTML = `<span>${formatted}${suffix}</span> ${label}`;
              }, 16);
            });
            observer.unobserve(statsBox);
          }
        });
      }, { threshold: 0.1 });
      observer.observe(statsBox);
    }
    window.addEventListener('load', startCountUpWhenVisible);

    document.addEventListener('DOMContentLoaded', () => {
      document.querySelectorAll('.scroll-to-auth').forEach(button => {
        button.addEventListener('click', (e) => {
          e.preventDefault();
          window.scrollTo({
            top: document.body.scrollHeight,
            behavior: 'smooth'
          });
        });
      });
    });
  </script>
</body>
</html>