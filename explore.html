<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FITTED.AI - Top AI Picks</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background-color: #f5f5f5;
            color: #333;
            padding-bottom: 140px;
        }
        .header {
            background-color: #f0f0f0;
            padding: 20px;
            display: flex;
            justify-content: center;
            align-items: center;
            border-bottom: 1px solid #ddd;
            position: relative;
        }
        .logo {
            font-size: 28px;
            font-weight: 900;
            letter-spacing: -1px;
            color: #2c3e50;
        }
        .menu-icon {
            font-size: 28px;
            cursor: pointer;
            position: absolute;
            right: 20px;
        }
        .page-title {
            text-align: center;
            font-size: 24px;
            font-weight: 600;
            margin: 30px 0;
            color: #2c3e50;
        }
        .store-module {
            max-width: 400px;
            margin: 0 auto 40px;
            padding: 20px;
            background-color: white;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        .user-budget {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid #eee;
        }
        .store-name {
            font-size: 18px;
            font-weight: 600;
        }
        .store-status {
            font-size: 14px;
            font-weight: 300;
            color: #999;
            margin-left: 8px;
        }
        .total-price {
            font-size: 20px;
            font-weight: 700;
            color: #2c3e50;
        }
        .products-grid {
            display: flex;
            flex-direction: column;
            gap: 15px;
            margin-bottom: 20px;
        }
        .product-card {
            background-color: #e8e8e8;
            border-radius: 12px;
            padding: 15px;
            display: flex;
            align-items: center;
            gap: 15px;
            cursor: pointer;
            transition: transform 0.2s;
        }
        .product-card:hover {
            transform: translateX(2px);
        }
        .product-image {
            width: 80px;
            height: 80px;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
            overflow: hidden;
            border-radius: 8px;
            background-color: #fff;
        }
        .product-image img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        .product-info {
            flex-grow: 1;
        }
        .product-name {
            font-size: 13px;
            font-weight: 500;
            margin-bottom: 5px;
            color: #555;
        }
        .product-price {
            font-size: 14px;
            font-weight: 600;
            color: #333;
        }
        .more-options {
            color: #999;
            font-size: 14px;
            margin-bottom: 15px;
        }
        .budget-buttons {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 12px;
            margin-bottom: 15px;
        }
        .budget-btn {
            background-color: white;
            border: 2px solid #333;
            padding: 12px 20px;
            border-radius: 8px;
            font-size: 15px;
            font-weight: normal;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            transition: all 0.2s;
        }
        .budget-btn:hover {
            background-color: #f8f8f8;
        }
        .budget-btn.active {
            background-color: #3498db;
            border-color: #3498db;
            color: white;
        }
        .budget-btn svg {
            width: 16px;
            height: 16px;
        }
        .add-to-cart {
            width: 100%;
            background-color: #2c3e50;
            color: white;
            border: none;
            padding: 16px;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: background-color 0.2s;
        }
        .add-to-cart:hover {
            background-color: #1a252f;
        }
        .browse-btn {
            position: fixed;
            bottom: 60px;
            left: 0;
            right: 0;
            max-width: 400px;
            margin: 0 auto;
            background-color: #3498db;
            color: white;
            border: none;
            padding: 16px;
            border-radius: 0;
            font-size: 15px;
            font-weight: normal;
            cursor: pointer;
            transition: background-color 0.2s;
            box-shadow: 0 -2px 10px rgba(0,0,0,0.1);
            z-index: 100;
        }
        .browse-btn:hover {
            background-color: #2980b9;
        }
        .loading {
            text-align: center;
            padding: 40px;
            color: #999;
        }
        .no-data {
            text-align: center;
            padding: 40px;
            color: #999;
        }

        /* Footer Navigation */
        .footer-nav {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background-color: white;
            border-top: 1px solid #ddd;
            display: flex;
            justify-content: space-around;
            padding: 15px 0;
            z-index: 100;
        }
        .nav-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            cursor: pointer;
            transition: all 0.2s;
        }
        .nav-item:hover {
            opacity: 0.7;
        }
        .nav-icon {
            width: 28px;
            height: 28px;
            margin-bottom: 5px;
        }
        .nav-label {
            font-size: 11px;
            color: #666;
        }
    </style>
</head>
<body>
    <div class="header">
        <div class="logo">FITTED.AI</div>
        <div class="menu-icon">â˜°</div>
    </div>
    <h1 class="page-title">Top Ai picks</h1>
    <div id="modules-container">
        <div class="loading">Loading your outfits...</div>
    </div>
    <button class="browse-btn" id="browse-all-btn">
        Browse All Products<br>
        <span style="font-size: 13px; opacity: 0.9;">Select Your Own</span>
    </button>

    <!-- Footer Navigation -->
    <div class="footer-nav">
        <div class="nav-item" id="nav-wardrobe">
            <svg class="nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M7 2h10M7 2v20M17 2v20M3 6h18M3 6v14a2 2 0 002 2h14a2 2 0 002-2V6"/>
                <circle cx="12" cy="12" r="2"/>
            </svg>
            <span class="nav-label">Wardrobe</span>
        </div>
        <div class="nav-item" id="nav-search">
            <svg class="nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <circle cx="11" cy="11" r="8"/>
                <path d="m21 21-4.35-4.35"/>
            </svg>
            <span class="nav-label">Search</span>
        </div>
        <div class="nav-item" id="nav-settings">
            <svg class="nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <circle cx="12" cy="12" r="3"/>
                <path d="M12 1v6m0 6v6M1 12h6m6 0h6"/>
                <path d="m4.93 4.93 4.24 4.24m5.66 0 4.24-4.24M4.93 19.07l4.24-4.24m5.66 0 4.24 4.24"/>
            </svg>
            <span class="nav-label">Settings</span>
        </div>
    </div>

    <script>
        // Calculate total price
        function calculateTotal(bundle) {
            if (!bundle || !Array.isArray(bundle.items)) return "0.00";
            return bundle.items.reduce((sum, item) => sum + (parseFloat(item.price) || 0), 0).toFixed(2);
        }
        // Render products
        function renderProducts(items) {
            return items.map(item => `
                <div class="product-card" onclick="window.open('${item.link}', '_blank')">
                    <div class="product-image">
                        ${item.image ? `<img src="${item.image}" alt="${item.title}">` : 'ðŸ‘•'}
                    </div>
                    <div class="product-info">
                        <div class="product-name">${item.title}</div>
                        <div class="product-price">$${item.price}</div>
                    </div>
                </div>
            `).join('');
        }
        // Create a store module
        // 2. Replace your createStoreModule function with this
        function createStoreModule(storeUrl, storeData) {
            const storeName = storeUrl;
        
            // Safely extract items arrays
            const recommendedItems = storeData.recommended?.items || [];
            const underBudgetItems   = storeData.under_budget?.items || [];
            const overBudgetItems    = storeData.over_budget?.items || [];
        
            const total = calculateTotal({ items: recommendedItems });
        
            const moduleId = `module-${storeName.replace(/[^a-z0-9]/gi, '-')}`;
        
            return `
                <div class="store-module" id="${moduleId}" data-current-view="recommended" data-store="${storeName}">
                    <div class="user-budget">
                        <div>
                            <span class="store-name">${storeName}</span>
                            <span class="store-status">recommended</span>
                        </div>
                        <div class="total-price">$${total}</div>
                    </div>
                    <div class="products-grid">
                        ${renderProducts(recommendedItems)}
                    </div>
                    <div class="more-options">More options from ${storeName}</div>
                    <div class="budget-buttons">
                        <button class="budget-btn" data-type="under" data-module="${moduleId}">Under budget</button>
                        <button class="budget-btn" data-type="over"  data-module="${moduleId}">Over budget</button>
                    </div>
                    <button class="add-to-cart" data-store="${storeName}">Add to cart</button>
                </div>
            `;
        }
        // Load and render data
        function loadOutfits() {
            const dataStr = sessionStorage.getItem('outfitData');
           
            if (!dataStr) {
                document.getElementById('modules-container').innerHTML =
                    '<div class="no-data">No outfits found. Please go back to settings.</div>';
                return;
            }
            try {
                const data = JSON.parse(dataStr);
                const container = document.getElementById('modules-container');
               
                window.outfitData = data;
               
                const modules = Object.entries(data)
                    .map(([storeUrl, storeData]) => createStoreModule(storeUrl, storeData))
                    .join('');
               
                container.innerHTML = modules;
               
                document.querySelectorAll('.budget-btn').forEach(btn => {
                    btn.addEventListener('click', handleBudgetClick);
                });
                document.querySelectorAll('.add-to-cart').forEach(btn => {
                    btn.addEventListener('click', handleAddToCart);
                });
               
            } catch (err) {
                console.error('Error loading outfits:', err);
                document.getElementById('modules-container').innerHTML =
                    '<div class="no-data">Error loading outfits. Please try again.</div>';
            }
        }

        // Handle budget button clicks
        function handleBudgetClick(e) {
            const btn = e.currentTarget;
            const type = btn.dataset.type;
            const moduleId = btn.dataset.module;
            const module = document.getElementById(moduleId);
            const currentView = module.dataset.currentView;

            const storeName = module.querySelector('.store-name').textContent;
            const storeData = window.outfitData[storeName];
            if (!storeData) return;

            const bundles = {
                recommended: storeData.recommended?.items || [],
                under: storeData.under_budget?.items || [],
                over: storeData.over_budget?.items || []
            };
            
            let items = [];
            let newView = 'recommended';
            
            if (currentView === 'recommended' && type === 'under') {
                items = bundles.under;
                newView = 'under';
            } else if (currentView === 'recommended' && type === 'over') {
                items = bundles.over;
                newView = 'over';
            } else {
                items = bundles.recommended;
                newView = 'recommended';
            }

            // Update UI
            module.querySelector('.products-grid').innerHTML = renderProducts(items);
            module.querySelector('.total-price').textContent = '$' + calculateTotal(items);
            module.querySelector('.store-status').textContent = 
                newView === 'under' ? 'under budget' : 
                newView === 'over' ? 'over budget' : 'recommended';
            module.dataset.currentView = newView;

            // Update button appearance
            module.querySelectorAll('.budget-btn').forEach(b => {
                b.classList.remove('active');
                if (newView === 'recommended') {
                    if (b.dataset.type === 'under') {
                        b.innerHTML = 'Under budget <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 5v14M19 12l-7 7-7-7"/></svg>';
                    } else {
                        b.innerHTML = 'Over budget <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 19V5M5 12l7-7 7 7"/></svg>';
                    }
                } else {
                    b.textContent = 'Recommended âœ¨';
                }
            });
            btn.classList.add('active');
        }

        // Handle add to cart
        function handleAddToCart(e) {
            const storeName = e.currentTarget.dataset.store;
            alert(`Adding items from ${storeName} to cart!`);
        }

        // Browse button
        document.getElementById('browse-all-btn').addEventListener('click', () => {
            alert('Browse all products coming soon!');
        });

        // Navigation handlers
        document.getElementById('nav-wardrobe').addEventListener('click', function() {
            window.location.href = 'wardrobe.html';
        });
        document.getElementById('nav-search').addEventListener('click', function() {
            window.location.href = 'settings.html';
        });
        document.getElementById('nav-settings').addEventListener('click', function() {
            window.location.href = 'settings.html';
        });

        // Initialize
        loadOutfits();
    </script>
</body>
</html>
